<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>AD</title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <!-- CSS Files -->
  <link href="./assets/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <div style="float: right;">
        <button onclick="showTrans()">Período transiente</button>
        <button onclick="showIC()">Intervalo de confiança</button>
        <button onclick="showRob()">Robustez</button>
    </div>
    <div class="trans">
        <h3>Período transiente</h3>
        <div class="row">
            <div class="col-md-6">
                <h5>Sem interrupção</h5>
                <button onclick="drawTransient('1s')">ρ1 = 0.1</button>
                <button onclick="drawTransient('2s')">ρ1 = 0.2</button>
                <button onclick="drawTransient('3s')">ρ1 = 0.3</button>
                <button onclick="drawTransient('4s')">ρ1 = 0.4</button>
                <button onclick="drawTransient('5s')">ρ1 = 0.5</button>
                <button onclick="drawTransient('6s')">ρ1 = 0.6</button>
                <button onclick="drawTransient('7s')">ρ1 = 0.7</button>
            </div>
            <div class="col-md-6">
                <h5>Com interrupção</h5>
                <button onclick="drawTransient('1c')">ρ1 = 0.1</button>
                <button onclick="drawTransient('2c')">ρ1 = 0.2</button>
                <button onclick="drawTransient('3c')">ρ1 = 0.3</button>
                <button onclick="drawTransient('4c')">ρ1 = 0.4</button>
                <button onclick="drawTransient('5c')">ρ1 = 0.5</button>
                <button onclick="drawTransient('6c')">ρ1 = 0.6</button>
                <button onclick="drawTransient('7c')">ρ1 = 0.7</button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <canvas id="transt1" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="transw1" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="transx1" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="transnq1" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="transt2" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="transw2" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="transnq2" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="transjitterE" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="transjitterV" width="400" height="400"></canvas>
            </div>
        </div>
    </div>
    <div class="ic">
        <h3>Intervalo de confiança</h3>
        <div class="row">
            <div class="col-md-6">
                <h5>Sem interrupção</h5>
                <button onclick="drawInterval('1s')">ρ1 = 0.1</button>
                <button onclick="drawInterval('2s')">ρ1 = 0.2</button>
                <button onclick="drawInterval('3s')">ρ1 = 0.3</button>
                <button onclick="drawInterval('4s')">ρ1 = 0.4</button>
                <button onclick="drawInterval('5s')">ρ1 = 0.5</button>
                <button onclick="drawInterval('6s')">ρ1 = 0.6</button>
                <button onclick="drawInterval('7s')">ρ1 = 0.7</button>
            </div>
            <div class="col-md-6">
                <h5>Com interrupção</h5>
                <button onclick="drawInterval('1c')">ρ1 = 0.1</button>
                <button onclick="drawInterval('2c')">ρ1 = 0.2</button>
                <button onclick="drawInterval('3c')">ρ1 = 0.3</button>
                <button onclick="drawInterval('4c')">ρ1 = 0.4</button>
                <button onclick="drawInterval('5c')">ρ1 = 0.5</button>
                <button onclick="drawInterval('6c')">ρ1 = 0.6</button>
                <button onclick="drawInterval('7c')">ρ1 = 0.7</button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <canvas id="ict1" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="icw1" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="icx1" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="icnq1" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="ict2" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="icw2" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="icnq2" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="icjitterE" width="400" height="400"></canvas>
            </div>
            <div class="col-md-3">
                <canvas id="icjitterV" width="400" height="400"></canvas>
            </div>
        </div>
    </div>
    <div class="robustez">
        <h3>Robustez</h3>
        <div class="row">
            <div class="col-md-6">
                <h5>Sem interrupção</h5>
                <button onclick="drawRobustez('s1')">ρ1 = 0.1</button>
                <button onclick="drawRobustez('s2')">ρ1 = 0.2</button>
                <button onclick="drawRobustez('s3')">ρ1 = 0.3</button>
                <button onclick="drawRobustez('s4')">ρ1 = 0.4</button>
                <button onclick="drawRobustez('s5')">ρ1 = 0.5</button>
                <button onclick="drawRobustez('s6')">ρ1 = 0.6</button>
                <button onclick="drawRobustez('s7')">ρ1 = 0.7</button>
            </div>
            <div class="col-md-6">
                <h5>Com interrupção</h5>
                <button onclick="drawRobustez('c1')">ρ1 = 0.1</button>
                <button onclick="drawRobustez('c2')">ρ1 = 0.2</button>
                <button onclick="drawRobustez('c3')">ρ1 = 0.3</button>
                <button onclick="drawRobustez('c4')">ρ1 = 0.4</button>
                <button onclick="drawRobustez('c5')">ρ1 = 0.5</button>
                <button onclick="drawRobustez('c6')">ρ1 = 0.6</button>
                <button onclick="drawRobustez('c7')">ρ1 = 0.7</button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <canvas id="chartRobustezData" width="400" height="400"></canvas>
            </div>
            <div class="col-md-6">
                <canvas id="chartRobustezVoice" width="400" height="400"></canvas>
            </div>
        </div>
    </div>
<script type="text/javascript" src="Chart.min.js"></script>
<script>
var sheet = (function() {
    // Create the <style> tag
    var style = document.createElement("style");

    // Add a media (and/or media query) here if you'd like!
    // style.setAttribute("media", "screen")
    // style.setAttribute("media", "only screen and (max-width : 1024px)")

    // WebKit hack :(
    style.appendChild(document.createTextNode(""));

    // Add the <style> element to the page
    document.head.appendChild(style);

    return style.sheet;
})();
function addCSSRule(sheet, selector, rules, index) {
    if("insertRule" in sheet) {
        sheet.insertRule(selector + "{" + rules + "}", index);
    }
    else if("addRule" in sheet) {
        sheet.addRule(selector, rules, index);
    }
}
addCSSRule(sheet, ".robustez", "display: none", 0);
addCSSRule(sheet, ".ic", "display: none", 1);

function showTrans(argument) {
    sheet.deleteRule(1);
    sheet.deleteRule(0);
    addCSSRule(sheet, ".ic", "display: none", 0);
    addCSSRule(sheet, ".robustez", "display: none", 1);
}
function showIC(argument) {
    sheet.deleteRule(1);
    sheet.deleteRule(0);
    addCSSRule(sheet, ".robustez", "display: none", 0);
    addCSSRule(sheet, ".trans", "display: none", 1);
}
function showRob(argument) {
    sheet.deleteRule(1);
    sheet.deleteRule(0);
    addCSSRule(sheet, ".trans", "display: none", 0);
    addCSSRule(sheet, ".ic", "display: none", 1);
}

var cctranst1  = createChart(document.getElementById("transt1").getContext('2d'), "t1");
var cctransw1  = createChart(document.getElementById("transw1").getContext('2d'), "w1");
var cctransx1  = createChart(document.getElementById("transx1").getContext('2d'), "x1");
var cctransnq1 = createChart(document.getElementById("transnq1").getContext('2d'), "nq1");
var cctranst2  = createChart(document.getElementById("transt2").getContext('2d'), "t2");
var cctransw2  = createChart(document.getElementById("transw2").getContext('2d'), "w2");
var cctransnq2 = createChart(document.getElementById("transnq2").getContext('2d'), "nq2");
var cctransej  = createChart(document.getElementById("transjitterE").getContext('2d'), "ej");
var cctransvj  = createChart(document.getElementById("transjitterV").getContext('2d'), "vj");
var ccict1  = createChart(document.getElementById("ict1").getContext('2d'), "t1");
var ccicw1  = createChart(document.getElementById("icw1").getContext('2d'), "w1");
var ccicx1  = createChart(document.getElementById("icx1").getContext('2d'), "x1");
var ccicnq1 = createChart(document.getElementById("icnq1").getContext('2d'), "nq1");
var ccict2  = createChart(document.getElementById("ict2").getContext('2d'), "t2");
var ccicw2  = createChart(document.getElementById("icw2").getContext('2d'), "w2");
var ccicnq2 = createChart(document.getElementById("icnq2").getContext('2d'), "nq2");
var ccicej  = createChart(document.getElementById("icjitterE").getContext('2d'), "ej");
var ccicvj  = createChart(document.getElementById("icjitterV").getContext('2d'), "vj");
var chartRobustezData  = createChart(document.getElementById("chartRobustezData").getContext('2d'), "Largura dos ICs da fila de dados");
var chartRobustezVoice  = createChart(document.getElementById("chartRobustezVoice").getContext('2d'), "Largura dos ICs da fila de voz");

var space = 10000
var t1 = [], w1 = [], x1 =  [],nq1 = [], t2 = [], w2 = [], nq2 = [], ej = [], vj = [], l=[];
var l1 = [0]
for (var i = 1; i <= 50; i++) {
    l1.push(space*i);
}

function createChart(ctx, label){
    return new Chart(ctx, {
            type: 'line',
            options: { 
                title: {
                    display: true,
                    text: label
                }, scales: {
                    yAxes: [{
                        ticks: { beginAtZero: true },
                        scaleLabel: { display: true, labelString: 'Largura do I.C. (em %)'}
                    }],
                    xAxes: [{
                        ticks: { beginAtZero: true },
                        scaleLabel: { display: true, labelString: 'Nº de amostras'}
                    }]
                }
            }
        }); 
}

function loadJSON(filename, callback) {   
    var xobj = new XMLHttpRequest();
    xobj.overrideMimeType("application/json");
    xobj.open('GET', 'results/' + filename + '.json', true);
    xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == "200") {
            // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
            callback(xobj.responseText);
        }
    };
    xobj.send(null);  
}


function callbackTransient(response){
    // Parse JSON string into object
    var j = JSON.parse(response);

    var t11 = [], w11 = [], x11 =  [],nq11 = [], t21 = [], w21 = [], nq21 = [], ej1 = [], vj1 = [], l1=[];
    var c = 0, m = Math.floor(j["simulations"].length/100);
    j["simulations"].forEach(function (s, i) {
        if (c%m == 0){
            t11.push(s["t1"]);
            w11.push(s["w1"]);
            x11.push(s["x1"]);
            nq11.push(s["nq1"]);
            t21.push(s["t2"]);
            w21.push(s["w2"]);
            nq21.push(s["nq2"]);
            ej1.push(s["jitterE"]);
            vj1.push(s["jitterV"]);
            l1.push(i*500)
        }
        c++;
    });
    t1.push(t11);
    w1.push(w11);
    x1.push(x11);
    nq1.push(nq11);
    t2.push(t21);
    w2.push(w21);
    nq2.push(nq21);
    ej.push(ej1);
    vj.push(vj1);
    l = l1;
    updateData(cctranst1, l, t1);
    updateData(cctransw1, l, w1);
    updateData(cctransx1, l, x1);
    updateData(cctransnq1, l, nq1);
    updateData(cctranst2, l, t2);
    updateData(cctransw2, l, w2);
    updateData(cctransnq2, l, nq2);
    updateData(cctransej, l, ej);
    updateData(cctransvj, l, vj);
}

function drawTransient(filename){
    filename = "ro"+filename;
    t1 = [], w1 = [], x1 =  [],nq1 = [], t2 = [], w2 = [], nq2 = [], ej = [], vj = [], l=[];
    loadJSON(filename+1, callbackTransient);
    loadJSON(filename+2, callbackTransient);
    loadJSON(filename+3, callbackTransient);
}

function updateData(chart, labelArray, dataArray){
    chart.options.scales.yAxes[0].scaleLabel.labelString = 'Valor calculado incrementalmente';
    chart.data.labels = labelArray;
    chart.data.datasets = [];
    dataArray.forEach((data, index) =>{
        chart.data.datasets.push(
            {
                label: index+1+"ª rodada",
                borderColor: getColor(index),
                data: data,
            });
        
    });
    chart.update();
}

function getColor(i){
    switch(i%5){
        case 0: return 'rgb(0, 99, 132)';
        case 1: return 'rgb(99, 0, 132)';
        case 2: return 'rgb(0, 0, 132)';
        case 3: return 'rgb(0, 99, 0)';
        case 4: return 'rgb(99, 99, 132)';
    }
}

function callBackInterval(response){
    // Parse JSON string into object
    var j = JSON.parse(response);
    var t11 = [0], w11 = [0], x11 =  [0],nq11 = [0], t21 = [0], w21 = [0], nq21 = [0], ej1 = [0], vj1 = [0];//, l1=[0]
    var c = 0;
    do {
        t11.push(0);
        w11.push(0);
        x11.push(0);
        nq11.push(0);
        t21.push(0);
        w21.push(0);
        nq21.push(0);
        ej1.push(0);
        vj1.push(0);
        c++
    } while (c < j.samples/space);
    j["simulations"].forEach(function (ss, i) {
        if (i*j.samples % space == 0){
            var s = ss["confidenceInterval"];
            if (s){
                c = 0;
                do {
                    t11.push(s["t1"]["percentage"]);
                    w11.push(s["w1"]["percentage"]);
                    x11.push(s["x1"]["percentage"]);
                    nq11.push(s["nq1"]["percentage"]);
                    t21.push(s["t2"]["percentage"]);
                    w21.push(s["w2"]["percentage"]);
                    nq21.push(s["nq2"]["percentage"]);
                    ej1.push(s["jitterMean"]["percentage"]);
                    vj1.push(s["jitterVariance"]["percentage"]);
                    c++
                } while (c < j.samples/space)
            }
        }
    });
    t1.push(t11);
    w1.push(w11);
    x1.push(x11);
    nq1.push(nq11);
    t2.push(t21);
    w2.push(w21);
    nq2.push(nq21);
    ej.push(ej1);
    vj.push(vj1);
    l.push(j.samples);
    updateIntervalData(ccict1, l1, t1, l);
    updateIntervalData(ccicw1, l1, w1, l);
    updateIntervalData(ccicx1, l1, x1, l);
    updateIntervalData(ccicnq1, l1, nq1, l);
    updateIntervalData(ccict2, l1, t2, l);
    updateIntervalData(ccicw2, l1, w2, l);
    updateIntervalData(ccicnq2, l1, nq2, l);
    updateIntervalData(ccicej, l1, ej, l);
    updateIntervalData(ccicvj, l1, vj, l);
}

function drawInterval(filename){
    filename = "intro" + filename
    t1 = [], w1 = [], x1 =  [],nq1 = [], t2 = [], w2 = [], nq2 = [], ej = [], vj = [], l=[];
    var samples = [100, 1000, 5000, 10000, 50000, 100000];
    for (var j = samples.length - 1; j >= 0; j--) {
        var f = filename + samples[j];
        loadJSON(f, callBackInterval);
    }
}

function updateIntervalData(chart, labelArray, dataArray, label){
    chart.options.scales.yAxes[0].scaleLabel.labelString = 'Largura do I.C. (em %)';
    chart.data.labels = labelArray;
    line = Array.apply(null, Array(labelArray.length)).map(Number.prototype.valueOf,10);
    chart.data.datasets = [
            {
                label: "10%",
                borderColor: 'rgb(132, 255, 132)',
                data: line,
            }];
    if (dataArray.length > 5){
        dataArray.forEach((data, index) =>{
            chart.data.datasets.push(
                {
                    label: label[index],
                    borderColor: getSampleColor(label[index]),
                    data: data,
                });
            
        });
        chart.update();
    }
}

function getSampleColor(s) {
    switch(s){
        case 100: return 'rgb(0, 99, 132)';
        case 1000: return 'rgb(99, 0, 132)';
        case 5000: return 'rgb(255, 0, 99)';
        case 10000: return 'rgb(0, 0, 132)';
        case 50000: return 'rgb(99, 99, 132)';
        case 100000: return 'rgb(0, 99, 0)';
    }
}

// function callbackResult(response){
//     // Parse JSON string into object
//     var j = JSON.parse(response);

//     var t11 = [], w11 = [], x11 =  [],nq11 = [], t21 = [], w21 = [], nq21 = [], ej1 = [], vj1 = [], l1=[];
//     j[0]["simulations"].forEach(function (s, i) {
//         t11.push(s["t1"]);
//         w11.push(s["w1"]);
//         x11.push(s["x1"]);
//         nq11.push(s["nq1"]);
//         t21.push(s["t2"]);
//         w21.push(s["w2"]);
//         nq21.push(s["nq2"]);
//         ej1.push(s["jitterE"]);
//         vj1.push(s["jitterV"]);
//         l1.push(i)
//     });
//     t1.push(t11);
//     w1.push(w11);
//     x1.push(x11);
//     nq1.push(nq11);
//     t2.push(t21);
//     w2.push(w21);
//     nq2.push(nq21);
//     ej.push(ej1);
//     vj.push(vj1);
//     l = l1;
//     updateResultData(cct1, l, t1);
//     updateResultData(ccw1, l, w1);
//     updateResultData(ccx1, l, x1);
//     updateResultData(ccnq1, l, nq1);
//     updateResultData(cct2, l, t2);
//     updateResultData(ccw2, l, w2);
//     updateResultData(ccnq2, l, nq2);
//     updateResultData(ccej, l, ej);
//     updateResultData(ccvj, l, vj);
// }

// function drawResultForFile(filename){
//     t1 = [], w1 = [], x1 =  [],nq1 = [], t2 = [], w2 = [], nq2 = [], ej = [], vj = [], l=[];
//     loadJSON(filename, callbackResult);
// }

// function updateResultData(chart, labelArray, dataArray){
//     chart.data.labels = labelArray;
//     chart.data.datasets = [];
//     dataArray.forEach((data, index) =>{
//         chart.data.datasets.push(
//             {
//                 label: "rodada",
//                 borderColor: 'rgb(0, 99, 132)',
//                 data: data,
//             });
        
//     });
//     chart.update();
// }

function callbackRobustez(response) {
    var j = JSON.parse(response);

    var dataD = [];
    var dataV = [];
    j.forEach((r, index)=>{
        var s = r["confidenceInterval"];
        dataD.push([s["t1"]["percentage"],
                    s["w1"]["percentage"],
                    s["x1"]["percentage"],
                    s["nq1"]["percentage"]]);
        dataV.push([s["t2"]["percentage"],
                    s["w2"]["percentage"],
                    s["nq2"]["percentage"],
                    s["jitterMean"]["percentage"],
                    s["jitterVariance"]["percentage"]]);
    })
    updateRobustezData(dataD, dataV)
}

function drawRobustez(type) {
    var filename = "results" + type;
    loadJSON(filename, callbackRobustez)
}

function updateRobustezData(dataArrayD, dataArrayV) {
    chartRobustezData.data.labels = ["T1", "W1", "X1", "Nq1"];
    lineD = Array.apply(null, Array(chartRobustezData.data.labels.length)).map(Number.prototype.valueOf,10);
    chartRobustezData.data.datasets = [
            {
                label: "10%",
                borderColor: 'rgb(132, 255, 132)',
                data: lineD,
            }];
    dataArrayD.forEach((data, index) =>{
        chartRobustezData.data.datasets.push(
            {
                borderColor: 'rgb(0,99,132)',
                data: data,
                showLine: false
            });
        
    });
    chartRobustezData.update();

    chartRobustezVoice.data.labels = ["T2", "W2", "Nq2", "E[Δ]", "V(Δ)"];
    lineV = Array.apply(null, Array(chartRobustezVoice.data.labels.length)).map(Number.prototype.valueOf,10);
    chartRobustezVoice.data.datasets = [
            {
                label: "10%",
                borderColor: 'rgb(132, 255, 132)',
                data: lineV,
            }];
    dataArrayV.forEach((data, index) =>{
        chartRobustezVoice.data.datasets.push(
            {
                borderColor: 'rgb(0,99,132)',
                data: data,
                showLine: false
            });
        
    });
    chartRobustezVoice.update();
}
</script>
</body>
</html>