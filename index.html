<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
    <h2>Período transiente</h2>
    <h3>Sem interrupção</h3>
    <button onclick="drawTransientForFile('ro1s')">ρ1 = 0.1</button>
    <button onclick="drawTransientForFile('ro2s')">ρ1 = 0.2</button>
    <button onclick="drawTransientForFile('ro3s')">ρ1 = 0.3</button>
    <button onclick="drawTransientForFile('ro4s')">ρ1 = 0.4</button>
    <button onclick="drawTransientForFile('ro5s')">ρ1 = 0.5</button>
    <button onclick="drawTransientForFile('ro6s')">ρ1 = 0.6</button>
    <button onclick="drawTransientForFile('ro7s')">ρ1 = 0.7</button>
    <h3>Com interrupção</h3>
    <button onclick="drawTransientForFile('ro1c')">ρ1 = 0.1</button>
    <button onclick="drawTransientForFile('ro2c')">ρ1 = 0.2</button>
    <button onclick="drawTransientForFile('ro3c')">ρ1 = 0.3</button>
    <button onclick="drawTransientForFile('ro4c')">ρ1 = 0.4</button>
    <button onclick="drawTransientForFile('ro5c')">ρ1 = 0.5</button>
    <button onclick="drawTransientForFile('ro6c')">ρ1 = 0.6</button>
    <button onclick="drawTransientForFile('ro7c')">ρ1 = 0.7</button>
    <h2>Intervalo de confiança</h2>
    <h3>Sem interrupção</h3>
    <button onclick="drawIntervalForFile('intro1s')">ρ1 = 0.1</button>
    <button onclick="drawIntervalForFile('intro2s')">ρ1 = 0.2</button>
    <button onclick="drawIntervalForFile('intro3s')">ρ1 = 0.3</button>
    <button onclick="drawIntervalForFile('intro4s')">ρ1 = 0.4</button>
    <button onclick="drawIntervalForFile('intro5s')">ρ1 = 0.5</button>
    <button onclick="drawIntervalForFile('intro6s')">ρ1 = 0.6</button>
    <button onclick="drawIntervalForFile('intro7s')">ρ1 = 0.7</button>
    <h3>Com interrupção</h3>
    <button onclick="drawIntervalForFile('intro1c')">ρ1 = 0.1</button>
    <button onclick="drawIntervalForFile('intro2c')">ρ1 = 0.2</button>
    <button onclick="drawIntervalForFile('intro3c')">ρ1 = 0.3</button>
    <button onclick="drawIntervalForFile('intro4c')">ρ1 = 0.4</button>
    <button onclick="drawIntervalForFile('intro5c')">ρ1 = 0.5</button>
    <button onclick="drawIntervalForFile('intro6c')">ρ1 = 0.6</button>
    <button onclick="drawIntervalForFile('intro7c')">ρ1 = 0.7</button>
    <div style="width: 50%">
        <canvas id="t1" width="400" height="400"></canvas>
    </div>
    <div style="width: 50%">
        <canvas id="w1" width="400" height="400"></canvas>
    </div>
    <div style="width: 50%">
        <canvas id="x1" width="400" height="400"></canvas>
    </div>
    <div style="width: 50%">
        <canvas id="nq1" width="400" height="400"></canvas>
    </div>
    <div style="width: 50%">
        <canvas id="t2" width="400" height="400"></canvas>
    </div>
    <div style="width: 50%">
        <canvas id="w2" width="400" height="400"></canvas>
    </div>
    <div style="width: 50%">
        <canvas id="nq2" width="400" height="400"></canvas>
    </div>
    <div style="width: 50%">
        <canvas id="jitterE" width="400" height="400"></canvas>
    </div>
    <div style="width: 50%">
        <canvas id="jitterV" width="400" height="400"></canvas>
    </div>
<script type="text/javascript" src="Chart.min.js"></script>
<script>
var cct1  = createChart(document.getElementById("t1").getContext('2d'), "t1");
var ccw1  = createChart(document.getElementById("w1").getContext('2d'), "w1");
var ccx1  = createChart(document.getElementById("x1").getContext('2d'), "x1");
var ccnq1 = createChart(document.getElementById("nq1").getContext('2d'), "nq1");
var cct2  = createChart(document.getElementById("t2").getContext('2d'), "t2");
var ccw2  = createChart(document.getElementById("w2").getContext('2d'), "w2");
var ccnq2 = createChart(document.getElementById("nq2").getContext('2d'), "nq2");
var ccej  = createChart(document.getElementById("jitterE").getContext('2d'), "ej");
var ccvj  = createChart(document.getElementById("jitterV").getContext('2d'), "vj");

function createChart(ctx, label){
    return new Chart(ctx, {
            type: 'line',
            options: { 
        title: {
            display: true,
            text: label
        }, scales: {yAxes: [{ ticks: { beginAtZero: true }}]}}
        }); 
}

function loadJSON(filename, callback) {   
    var xobj = new XMLHttpRequest();
    xobj.overrideMimeType("application/json");
    xobj.open('GET', 'results/' + filename + '.json', true);
    xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == "200") {
            // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
            callback(xobj.responseText);
        }
    };
    xobj.send(null);  
}

var t1 = [], w1 = [], x1 =  [],nq1 = [], t2 = [], w2 = [], nq2 = [], ej = [], vj = [], l=[];

function callbackTransient(response){
    // Parse JSON string into object
    var j = JSON.parse(response);

    var t11 = [], w11 = [], x11 =  [],nq11 = [], t21 = [], w21 = [], nq21 = [], ej1 = [], vj1 = [], l1=[];
    var c = 0, m = Math.floor(j["simulations"].length/100);
    j["simulations"].forEach(function (s, i) {
        if (c%m == 0){
            t11.push(s["t1"]);
            w11.push(s["w1"]);
            x11.push(s["x1"]);
            nq11.push(s["nq1"]);
            t21.push(s["t2"]);
            w21.push(s["w2"]);
            nq21.push(s["nq2"]);
            ej1.push(s["jitterE"]);
            vj1.push(s["jitterV"]);
            l1.push(i*500)
        }
        c++;
    });
    t1.push(t11);
    w1.push(w11);
    x1.push(x11);
    nq1.push(nq11);
    t2.push(t21);
    w2.push(w21);
    nq2.push(nq21);
    ej.push(ej1);
    vj.push(vj1);
    l = l1;
    updateData(cct1, l, t1);
    updateData(ccw1, l, w1);
    updateData(ccx1, l, x1);
    updateData(ccnq1, l, nq1);
    updateData(cct2, l, t2);
    updateData(ccw2, l, w2);
    updateData(ccnq2, l, nq2);
    updateData(ccej, l, ej);
    updateData(ccvj, l, vj);
}

function drawTransientForFile(filename){
    t1 = [], w1 = [], x1 =  [],nq1 = [], t2 = [], w2 = [], nq2 = [], ej = [], vj = [], l=[];
    loadJSON(filename+1, callbackTransient);
    loadJSON(filename+2, callbackTransient);
    loadJSON(filename+3, callbackTransient);
}

function updateData(chart, labelArray, dataArray){
    chart.data.labels = labelArray;
    chart.data.datasets = [];
    dataArray.forEach((data, index) =>{
        chart.data.datasets.push(
            {
                label: index+1+"ª rodada",
                borderColor: getColor(index),
                data: data,
            });
        
    });
    chart.update();
}

function getColor(i){
    switch(i%5){
        case 0: return 'rgb(0, 99, 132)';
        case 1: return 'rgb(99, 0, 132)';
        case 2: return 'rgb(0, 0, 132)';
        case 3: return 'rgb(0, 99, 0)';
        case 4: return 'rgb(99, 99, 132)';
    }
}
var space = 10000
var l1 = [0]
for (var i = 1; i <= 50; i++) {
    l1.push(space*i);
}
function callBackInterval(response){
    // Parse JSON string into object
    var j = JSON.parse(response);
    var t11 = [0], w11 = [0], x11 =  [0],nq11 = [0], t21 = [0], w21 = [0], nq21 = [0], ej1 = [0], vj1 = [0];//, l1=[0]
    var c = 0;
    do {
        t11.push(0);
        w11.push(0);
        x11.push(0);
        nq11.push(0);
        t21.push(0);
        w21.push(0);
        nq21.push(0);
        ej1.push(0);
        vj1.push(0);
        c++
    } while (c < j.samples/space);
    j["simulations"].forEach(function (ss, i) {
        if (i*j.samples % space == 0){
            var s = ss["confidenceInterval"];
            if (s){
                c = 0;
                do {
                    t11.push(s["t1"]["percentage"]);
                    w11.push(s["w1"]["percentage"]);
                    x11.push(s["x1"]["percentage"]);
                    nq11.push(s["nq1"]["percentage"]);
                    t21.push(s["t2"]["percentage"]);
                    w21.push(s["w2"]["percentage"]);
                    nq21.push(s["nq2"]["percentage"]);
                    ej1.push(s["jitterMean"]["percentage"]);
                    vj1.push(s["jitterVariance"]["percentage"]);
                    c++
                } while (c < j.samples/space)
            }
        }
    });
    t1.push(t11);
    w1.push(w11);
    x1.push(x11);
    nq1.push(nq11);
    t2.push(t21);
    w2.push(w21);
    nq2.push(nq21);
    ej.push(ej1);
    vj.push(vj1);
    l.push(j.samples);
    updateIntervalData(cct1, l1, t1, l);
    updateIntervalData(ccw1, l1, w1, l);
    updateIntervalData(ccx1, l1, x1, l);
    updateIntervalData(ccnq1, l1, nq1, l);
    updateIntervalData(cct2, l1, t2, l);
    updateIntervalData(ccw2, l1, w2, l);
    updateIntervalData(ccnq2, l1, nq2, l);
    updateIntervalData(ccej, l1, ej, l);
    updateIntervalData(ccvj, l1, vj, l);
}

function drawIntervalForFile(filename){
    t1 = [], w1 = [], x1 =  [],nq1 = [], t2 = [], w2 = [], nq2 = [], ej = [], vj = [], l=[];
    var samples = [100, 1000, 5000, 10000, 50000, 100000];
    for (var j = samples.length - 1; j >= 0; j--) {
        var f = filename + samples[j];
        loadJSON(f, callBackInterval);
    }
}

function updateIntervalData(chart, labelArray, dataArray, label){
    chart.data.labels = labelArray;
    line = Array.apply(null, Array(labelArray.length)).map(Number.prototype.valueOf,10);
    chart.data.datasets = [
            {
                label: "10%",
                borderColor: 'rgb(132, 255, 132)',
                data: line,
            }];
    console.log(dataArray)
    dataArray.forEach((data, index) =>{
        data[0] = 0
        data.forEach((d, i)=>{
            if(d == undefined) data[i] = data[i-1];
        })
        chart.data.datasets.push(
            {
                label: label[index],
                borderColor: getSampleColor(label[index]),
                data: data,
            });
        
    });
    chart.update();
}

function getSampleColor(s) {
    switch(s){
        case 100: return 'rgb(0, 99, 132)';
        case 1000: return 'rgb(99, 0, 132)';
        case 5000: return 'rgb(255, 0, 99)';
        case 10000: return 'rgb(0, 0, 132)';
        case 50000: return 'rgb(99, 99, 132)';
        case 100000: return 'rgb(0, 99, 0)';
    }
}

function callbackResult(response){
    // Parse JSON string into object
    var j = JSON.parse(response);

    var t11 = [], w11 = [], x11 =  [],nq11 = [], t21 = [], w21 = [], nq21 = [], ej1 = [], vj1 = [], l1=[];
    j[0]["simulations"].forEach(function (s, i) {
        t11.push(s["t1"]);
        w11.push(s["w1"]);
        x11.push(s["x1"]);
        nq11.push(s["nq1"]);
        t21.push(s["t2"]);
        w21.push(s["w2"]);
        nq21.push(s["nq2"]);
        ej1.push(s["jitterE"]);
        vj1.push(s["jitterV"]);
        l1.push(i)
    });
    t1.push(t11);
    w1.push(w11);
    x1.push(x11);
    nq1.push(nq11);
    t2.push(t21);
    w2.push(w21);
    nq2.push(nq21);
    ej.push(ej1);
    vj.push(vj1);
    l = l1;
    updateResultData(cct1, l, t1);
    updateResultData(ccw1, l, w1);
    updateResultData(ccx1, l, x1);
    updateResultData(ccnq1, l, nq1);
    updateResultData(cct2, l, t2);
    updateResultData(ccw2, l, w2);
    updateResultData(ccnq2, l, nq2);
    updateResultData(ccej, l, ej);
    updateResultData(ccvj, l, vj);
}

function drawResultForFile(filename){
    t1 = [], w1 = [], x1 =  [],nq1 = [], t2 = [], w2 = [], nq2 = [], ej = [], vj = [], l=[];
    loadJSON(filename, callbackResult);
}

function updateResultData(chart, labelArray, dataArray){
    chart.data.labels = labelArray;
    chart.data.datasets = [];
    dataArray.forEach((data, index) =>{
        chart.data.datasets.push(
            {
                label: "rodada",
                borderColor: 'rgb(0, 99, 132)',
                data: data,
            });
        
    });
    chart.update();
}

drawResultForFile("resultado");
</script>
</body>
</html>